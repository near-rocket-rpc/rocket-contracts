use near_contract_standards::fungible_token::{
    metadata::{FungibleTokenMetadata, FungibleTokenMetadataProvider, FT_METADATA_SPEC},
    FungibleToken,
};
use near_sdk::{
    borsh::{self, BorshDeserialize, BorshSerialize},
    env,
    json_types::U128,
    near_bindgen, require, AccountId, BorshStorageKey, PanicOnDefault, PromiseOrValue,
};

const ICON_DATA_URL: &str = "data:image/svg+xml,%3c%3fxml version='1.0' encoding='iso-8859-1'%3f%3e %3c!-- Generator: Adobe Illustrator 19.0.0%2c SVG Export Plug-In . SVG Version: 6.00 Build 0) --%3e %3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' id='Layer_1' x='0px' y='0px' viewBox='0 0 416.449 416.449' style='enable-background:new 0 0 416.449 416.449%3b' xml:space='preserve' width='512' height='512'%3e%3cg id='_x31_5._Rocket_2_'%3e%3cg id='XMLID_65_'%3e%3cg%3e%3cg%3e%3cpath style='fill:%23FF7124%3b' d='M399.76%2c16.699c10.12%2c37.84%2c8.67%2c78.13-4.34%2c115.28h-0.01L284.48%2c21.049v-0.01 C321.63%2c8.029%2c361.92%2c6.579%2c399.76%2c16.699z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%23F2D59F%3b' d='M90.21%2c207.929l87.14-101.42h0.01l33.71-39.24c21.43-21.43%2c46.6-36.84%2c73.41-46.23v0.01 l110.93%2c110.93h0.01c-9.39%2c26.81-24.8%2c51.98-46.23%2c73.41l-39.24%2c33.71l-101.43%2c87.14l-29.57-29.57l-29.58-29.58l-29.58-29.58 L90.21%2c207.929z M296.11%2c193.399c20.18-20.17%2c20.18-52.89%2c0-73.06c-20.17-20.18-52.89-20.18-73.06%2c0 c-20.18%2c20.17-20.18%2c52.89%2c0%2c73.06C243.22%2c213.579%2c275.94%2c213.579%2c296.11%2c193.399z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%23F2D59F%3b' d='M309.95%2c239.099c1.74%2c45.6-14.8%2c91.78-49.61%2c126.59c-10.69%2c10.68-22.44%2c19.65-34.93%2c26.89 l-16.89-66.34L309.95%2c239.099z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%238ECAC1%3b' d='M296.11%2c120.339c20.18%2c20.17%2c20.18%2c52.89%2c0%2c73.06c-20.17%2c20.18-52.89%2c20.18-73.06%2c0 c-20.18-20.17-20.18-52.89%2c0-73.06C243.22%2c100.159%2c275.94%2c100.159%2c296.11%2c120.339z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%23E6B263%3b' d='M208.52%2c326.239l-39.94%2c14.71c-10.98%2c4.05-23.31%2c1.34-31.58-6.94l-6.85-6.85l48.8-30.49 L208.52%2c326.239z'/%3e%3c/g%3e%3cg%3e%3cpolygon style='fill:%23E6B263%3b' points='178.95%2c296.669 130.15%2c327.159 130.14%2c327.159 109.72%2c306.739 149.37%2c267.089 '/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%23F2D59F%3b' d='M177.35%2c106.509l-87.14%2c101.42l-66.33-16.88c7.24-12.49%2c16.21-24.24%2c26.89-34.93 C85.58%2c121.309%2c131.74%2c104.769%2c177.35%2c106.509z'/%3e%3c/g%3e%3cg%3e%3cpolygon style='fill:%23E6B263%3b' points='149.37%2c267.089 109.72%2c306.739 89.3%2c286.309 119.79%2c237.509 '/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%23E6B263%3b' d='M119.79%2c237.509l-30.49%2c48.8l-6.86-6.85c-8.27-8.28-10.98-20.6-6.94-31.58l14.71-39.95 L119.79%2c237.509z'/%3e%3c/g%3e%3c/g%3e%3cg%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M28.88%2c339.459c-2.559%2c0-5.119-0.977-7.071-2.929c-3.905-3.905-3.905-10.237%2c0-14.143 l20.54-20.54c3.905-3.904%2c10.237-3.904%2c14.143%2c0c3.905%2c3.905%2c3.905%2c10.237%2c0%2c14.143l-20.54%2c20.54 C33.999%2c338.482%2c31.44%2c339.459%2c28.88%2c339.459z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M10%2c416.439c-2.56%2c0-5.119-0.977-7.072-2.93c-3.905-3.905-3.904-10.237%2c0.001-14.142l68.47-68.46 c3.905-3.904%2c10.237-3.904%2c14.142%2c0.001c3.905%2c3.905%2c3.904%2c10.237-0.002%2c14.142l-68.47%2c68.46 C15.118%2c415.463%2c12.559%2c416.439%2c10%2c416.439z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M73.29%2c411.259c-2.56%2c0-5.118-0.977-7.071-2.929c-3.905-3.905-3.905-10.237%2c0-14.143 l34.23-34.229c3.905-3.904%2c10.237-3.903%2c14.142%2c0c3.905%2c3.905%2c3.905%2c10.237%2c0%2c14.143l-34.23%2c34.229 C78.409%2c410.282%2c75.849%2c411.259%2c73.29%2c411.259z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M208.52%2c336.239c-2.56%2c0-5.118-0.977-7.071-2.929L83.139%2c215c-3.905-3.905-3.905-10.237%2c0-14.143 c3.905-3.904%2c10.237-3.904%2c14.143%2c0l118.31%2c118.311c3.905%2c3.905%2c3.905%2c10.237%2c0%2c14.143 C213.639%2c335.263%2c211.079%2c336.239%2c208.52%2c336.239z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M259.58%2c218.534c-16.474%2c0-31.959-6.416-43.604-18.066c-11.646-11.641-18.062-27.126-18.062-43.6 c0-16.474%2c6.416-31.959%2c18.065-43.604c11.641-11.646%2c27.126-18.062%2c43.6-18.062s31.959%2c6.416%2c43.604%2c18.065 c11.645%2c11.641%2c18.061%2c27.126%2c18.061%2c43.6c0%2c16.472-6.415%2c31.956-18.061%2c43.6l0%2c0c-0.001%2c0.002-0.001%2c0.001-0.004%2c0.004 C291.536%2c212.119%2c276.052%2c218.534%2c259.58%2c218.534z M259.58%2c115.204c-11.13%2c0-21.592%2c4.334-29.457%2c12.204 c-7.874%2c7.869-12.208%2c18.331-12.208%2c29.461s4.334%2c21.592%2c12.204%2c29.457c7.869%2c7.874%2c18.331%2c12.208%2c29.461%2c12.208 c11.13%2c0%2c21.592-4.334%2c29.457-12.204c0.002-0.001%2c0.003-0.002%2c0.004-0.004c7.87-7.865%2c12.204-18.327%2c12.204-29.457 s-4.334-21.592-12.204-29.457C281.172%2c119.538%2c270.71%2c115.204%2c259.58%2c115.204z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M89.291%2c296.31c-1.81%2c0-3.642-0.49-5.29-1.521c-4.684-2.926-6.108-9.096-3.182-13.779l30.49-48.8 c2.927-4.684%2c9.097-6.11%2c13.78-3.182c4.684%2c2.926%2c6.108%2c9.096%2c3.182%2c13.779l-30.49%2c48.8 C95.884%2c294.643%2c92.625%2c296.31%2c89.291%2c296.31z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M109.72%2c316.739c-2.559%2c0-5.118-0.977-7.071-2.929c-3.905-3.905-3.906-10.237-0.001-14.143 l39.65-39.65c3.905-3.904%2c10.237-3.904%2c14.142%2c0c3.905%2c3.905%2c3.906%2c10.237%2c0.001%2c14.142l-39.65%2c39.65 C114.839%2c315.763%2c112.279%2c316.739%2c109.72%2c316.739z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M130.16%2c337.16c-3.334%2c0-6.593-1.666-8.49-4.702c-2.926-4.684-1.501-10.854%2c3.182-13.779 l48.8-30.49c4.683-2.929%2c10.853-1.503%2c13.78%2c3.182c2.926%2c4.684%2c1.501%2c10.853-3.182%2c13.779l-48.8%2c30.49 C133.801%2c336.67%2c131.97%2c337.16%2c130.16%2c337.16z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M177.356%2c116.509c-2.307%2c0-4.625-0.794-6.512-2.415c-4.189-3.599-4.668-9.912-1.069-14.102 l33.71-39.24c3.598-4.188%2c9.911-4.668%2c14.102-1.068c4.189%2c3.599%2c4.668%2c9.912%2c1.068%2c14.101l-33.71%2c39.24 C182.968%2c115.327%2c180.17%2c116.509%2c177.356%2c116.509z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M158.265%2c352.787c-10.448%2c0-20.723-4.085-28.34-11.712l-6.582-6.582 c-0.093-0.086-0.184-0.173-0.273-0.263l-47.694-47.695c-10.992-11.006-14.623-27.531-9.259-42.109l14.71-39.952 c0.413-1.12%2c1.022-2.157%2c1.799-3.061l87.14-101.42c3.601-4.188%2c9.913-4.667%2c14.102-1.068c4.189%2c3.6%2c4.667%2c9.913%2c1.068%2c14.102 L98.971%2c213.077l-14.086%2c38.257c-2.682%2c7.289-0.864%2c15.556%2c4.632%2c21.059l47.432%2c47.433c0.092%2c0.086%2c0.184%2c0.173%2c0.273%2c0.263 l6.85%2c6.85c5.497%2c5.504%2c13.756%2c7.318%2c21.048%2c4.63l38.252-14.089l139.302-119.675c4.191-3.6%2c10.504-3.119%2c14.102%2c1.068 c3.6%2c4.189%2c3.121%2c10.503-1.068%2c14.102L215.036%2c333.824c-0.904%2c0.777-1.94%2c1.387-3.059%2c1.799l-39.941%2c14.71 C167.557%2c351.985%2c162.893%2c352.787%2c158.265%2c352.787z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M349.19%2c215.389c-2.559%2c0-5.118-0.977-7.071-2.929c-3.905-3.905-3.905-10.237%2c0-14.143 c19.885-19.884%2c34.642-43.315%2c43.863-69.644c11.736-33.512%2c13.626-69.25%2c5.536-103.733c-34.48-8.089-70.221-6.199-103.733%2c5.536 c-26.329%2c9.221-49.761%2c23.979-69.645%2c43.863c-3.905%2c3.904-10.236%2c3.905-14.143%2c0c-3.905-3.905-3.905-10.237%2c0-14.143 c22.025-22.024%2c47.991-38.375%2c77.176-48.596C320.331-2.111%2c362.231-3.69%2c402.344%2c7.039c3.454%2c0.924%2c6.152%2c3.622%2c7.076%2c7.076 c10.728%2c40.114%2c9.151%2c82.014-4.563%2c121.17c-10.221%2c29.185-26.571%2c55.15-48.596%2c77.175 C354.309%2c214.412%2c351.75%2c215.389%2c349.19%2c215.389z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M395.41%2c141.98c-2.56%2c0-5.118-0.977-7.071-2.929L277.409%2c28.12 c-3.905-3.905-3.905-10.237%2c0-14.143c3.908-3.905%2c10.238-3.903%2c14.143%2c0l110.93%2c110.931c3.905%2c3.905%2c3.905%2c10.237%2c0%2c14.143 C400.528%2c141.003%2c397.969%2c141.98%2c395.41%2c141.98z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M90.22%2c217.929c-0.832%2c0-1.67-0.104-2.477-0.309l-66.33-16.88 c-3.037-0.773-5.537-2.926-6.751-5.814c-1.215-2.889-1.005-6.181%2c0.566-8.892c7.778-13.418%2c17.355-25.86%2c28.467-36.982 c35.281-35.281%2c84.119-54.445%2c133.988-52.537c5.369%2c0.176%2c9.671%2c4.583%2c9.671%2c9.994c0%2c5.522-4.472%2c10-9.995%2c10h-0.01 c-0.127%2c0-0.254-0.002-0.381-0.007c-44.338-1.699-87.765%2c15.325-119.127%2c46.688c-6.684%2c6.689-12.742%2c13.914-18.101%2c21.576 l52.73%2c13.419c4.435%2c1.024%2c7.745%2c4.998%2c7.745%2c9.743C100.215%2c213.451%2c95.743%2c217.929%2c90.22%2c217.929z'/%3e%3c/g%3e%3cg%3e%3cpath style='fill:%235E2A41%3b' d='M225.41%2c402.579c-1.315%2c0-2.633-0.259-3.876-0.782c-2.89-1.215-5.042-3.714-5.815-6.75 l-16.891-66.34c-1.363-5.353%2c1.872-10.796%2c7.224-12.158c5.349-1.366%2c10.795%2c1.871%2c12.158%2c7.223l13.48%2c52.948 c7.663-5.359%2c14.889-11.419%2c21.581-18.104c31.36-31.36%2c48.378-74.785%2c46.684-119.136c-0.21-5.519%2c4.093-10.163%2c9.611-10.374 c5.509-0.233%2c10.164%2c4.093%2c10.375%2c9.611c1.903%2c49.897-17.243%2c98.755-52.532%2c134.044c-11.124%2c11.113-23.567%2c20.691-36.986%2c28.47 C228.881%2c402.126%2c227.148%2c402.579%2c225.41%2c402.579z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e";

#[derive(BorshSerialize, BorshStorageKey)]
enum StorageKey {
    FungibleToken,
}

#[near_bindgen]
#[derive(BorshSerialize, BorshDeserialize, PanicOnDefault)]
pub struct Token {
    owner_id: AccountId,
    tokens: FungibleToken,
}

#[near_bindgen]
impl Token {
    #[init]
    pub fn new(owner_id: AccountId) -> Self {
        Self {
            owner_id,
            tokens: FungibleToken::new(StorageKey::FungibleToken),
        }
    }
}

near_contract_standards::impl_fungible_token_core!(Token, tokens);
near_contract_standards::impl_fungible_token_storage!(Token, tokens);

#[near_bindgen]
impl FungibleTokenMetadataProvider for Token {
    fn ft_metadata(&self) -> FungibleTokenMetadata {
        FungibleTokenMetadata {
            spec: FT_METADATA_SPEC.to_string(),
            name: String::from("Rocket RPC"),
            symbol: String::from("RPC"),
            icon: Some(String::from(ICON_DATA_URL)),
            reference: None,
            reference_hash: None,
            decimals: 18,
        }
    }
}

#[near_bindgen]
impl Token {
    /// mint new RPC tokens
    pub fn mint(&mut self) {
        let account_id = env::predecessor_account_id();
        let amount = 1_000 * 1_000_000_000_000_000_000; // 1000 RPC

        if !self.tokens.accounts.contains_key(&account_id) {
            self.tokens.internal_register_account(&account_id);
        }
        self.tokens.internal_deposit(&account_id, amount);
    }
}
